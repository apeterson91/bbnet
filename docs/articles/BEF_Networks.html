<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Effects • rsstap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Network Effects">
<meta property="og:description" content="rsstap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rsstap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BEF_Networks.html">Network Effects</a>
    </li>
    <li>
      <a href="../articles/Introduction.html">Introduction to `rsstap`</a>
    </li>
    <li>
      <a href="../articles/Longitudinal_Models.html">Longitudinal Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/apeterson91/rsstap/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="BEF_Networks_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Network Effects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/apeterson91/rsstap/blob/master/vignettes/BEF_Networks.Rmd"><code>vignettes/BEF_Networks.Rmd</code></a></small>
      <div class="hidden name"><code>BEF_Networks.Rmd</code></div>

    </div>

    
    
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The <a href="https://apeterson91.github.io/rsstap/articles/Introduction.html">introductory</a> and <a href="https://apeterson91.github.io/rsstap/articles/Introduction.html">longitudinal</a> vignettes introduced the STAP modeling framework for estimating the effect of Built Environment Features (BEFs) as a function of space - how far they are from where subjects are (e.g. residential addresses) - and time - how long they live at that distance - in both a cross-sectional and longitudinal setting. In both settings the primary measurement was that between the subject and the BEF and consequently the effect estimated corresponded to that of conceptually placing a BEF at a certain point in space and time relative to the subject, henceforth called a <strong>Direct Effect</strong>.</p>
<p>In this vignette we introduce the concept of <strong>Indirect Effects</strong>, that is, the effect associated with placing a BEF of the same or different type near another BEF. For example, placing one Fast Food Restaurant (FFR) near another FFR may increase the overall effect of those two FFRs to be more than what either FFR would have alone.</p>
<p>In this way, one can think of a <em>network</em> of BEFs, each amplifying or dampening the effects of one another according to their type, placement, and quantity in space/time.</p>
<p>What follows is a graphical illustration of this idea, a brief elaboration over the model framework as well as a discussion of the data set-up and relevant software syntax for fitting the model in <code>rsstap</code>. A sample model fitting using simulated data generated to mimic the hypothetical FFR example previously described completes the vignette. Before we get started, we’ll load the necessary libraries and data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rsstap</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rbenvo</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidygraph</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggraph</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"network_benvo"</span>)</pre></body></html></div>
</div>
<div id="illustration" class="section level1">
<h1 class="hasAnchor">
<a href="#illustration" class="anchor"></a>Illustration</h1>
<p>Direct Effects as previously described are those effects between a subject, where the outcome is observed, and a nearby BEF. To visualize this, consider the following graphic, where subject and FFR (as an example) locations are positioned to facilitate visualization.</p>
<p><img src="BEF_Networks_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The gold-orange colored lines indicate how the direct effects are estimated and understood - as the distance between a FFR and a subject. Similarly, The blue lines illustrate how the indirect effects are understood, the additional effect from having two FFRs located near one another. In the next section we’ll demonstrate how these ideas manifest in the model mathematics.</p>
</div>
<div id="bef-network-effects-model" class="section level1">
<h1 class="hasAnchor">
<a href="#bef-network-effects-model" class="anchor"></a>BEF Network Effects Model</h1>
<p>For outcome <span class="math inline">\(Y_i\)</span> measured on the <span class="math inline">\(i\)</span>th subject, <span class="math inline">\(i=1,...,n\)</span> alongside subject covariates (e.g. sex, age, etc.) <span class="math inline">\(\mathbf{Z}_i\)</span> and their corresponding effects <span class="math inline">\(\mathbf{\delta}\)</span>, the BEF network effects model extends the STAP model to include the Direct and Indirect Effects of BEFs (Spatial effects of FFRs in our example) in the following manner:</p>
<p><span class="math display">\[
E[Y_i] = \alpha + \mathbf{Z}_i^T \mathbf{\delta} + f(\text{Direct FFR}_i) + f(\text{Indirect  FFR}_i),
\]</span> where the direct effect is modeled similar to the first example in the introductory vignette and <span class="math display">\[
f(\text{Indirect }FFR_i), = \sum_{l=1}^{L} \sum_{d \in \mathcal{\mathcal{Q}_i}} \beta_l\phi_l(d).
\]</span> In the above, <span class="math inline">\(d\)</span> is the distance between two nearby FFRs that are also near subject <span class="math inline">\(i\)</span> and <span class="math inline">\(\mathcal{Q}\)</span> is the set of all such between FFR distances for subject <span class="math inline">\(i\)</span>. Similar to all STAP models, <span class="math inline">\(\beta_l\)</span> and <span class="math inline">\(\phi_l\)</span> are basis function coefficients and expansion functions. It should be noted here that identifying concepts such as “near” likely require substantive knowledge to avoid over-including too many FFRs. Similarly,there is an important identifiability constraint here (as with all STAPs) that there be a different number of FFRs nearby one another. This is usually trivially satisfied in most practical applications, but it bears mentioning.</p>
<p>With all this modelling notation out of the way, we’ll move onto how to fit and explore these models using the <code>rsstap</code> package.</p>
<div id="example-model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#example-model-fitting" class="anchor"></a>Example Model Fitting</h2>
<p>We’ll first show some descriptive information of the <code>benvo</code> that holds both the FFR and FFR-FFR distances. Note that the indirect distances/features can be included in a benvo just like any other BEF.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">network_benvo</span>
<span class="co">#&gt; Subject Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Observations:  2000</span>
<span class="co">#&gt; Columns:  5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; BEF Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Number of Features:  2</span>
<span class="co">#&gt; Features: </span>
<span class="co">#&gt;           Name Measures</span>
<span class="co">#&gt; 1   Direct FFR Distance</span>
<span class="co">#&gt; 2 Indirect FFR Distance</span></pre></body></html></div>
<p>While we might normally spend some time doing exploratory data analysis to more fully understand these data, in the interest of exposition, we’ll skip right to the model fitting to demonstrate how this model is fit. Thankfully, the syntax is fairly straightforward: an additional <code>sap()</code> term is included in the model formula, treating the extra distances as nothing more than another BEF term to be included in the model.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sstap_lm.html">sstap_lm</a></span>(<span class="no">BMI</span> ~ <span class="no">sex</span> + <span class="fu">sap</span>(<span class="no">`Direct FFR`</span>) + <span class="fu">sap</span>(<span class="no">`Indirect FFR`</span>),
                <span class="kw">benvo</span><span class="kw">=</span><span class="no">network_benvo</span>, <span class="kw">QR</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p>Plotting the estimates alongside the true curves we can see that the model accurately captures both the direct and indirect effect.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit</span>) + <span class="no">truth</span>  + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Direct FFR Effect"</span>)</pre></body></html></div>
<p><img src="BEF_Networks_files/figure-html/plot_direct-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit</span>,<span class="st">"Indirect FFR"</span>) + <span class="no">truth</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Indirect FFR Effect"</span>)</pre></body></html></div>
<p><img src="BEF_Networks_files/figure-html/plot_indirect-1.png" width="700"></p>
</div>
<div id="caveats-and-reminders" class="section level2">
<h2 class="hasAnchor">
<a href="#caveats-and-reminders" class="anchor"></a>Caveats and Reminders</h2>
<div id="signal-strength" class="section level3">
<h3 class="hasAnchor">
<a href="#signal-strength" class="anchor"></a>Signal Strength</h3>
<p>It is important to remember that the indirect effects are a kind of interaction effect as they require the presence of both the FFR, the subject <em>and</em> other nearby FFRs. Furthermore, the indirect effect is generally likely to be smaller than the direct effect (as in this case), which are typically already very small. All this is to say that in order to have a reasonable chance of estimating these functions a large sample size (as with our simulated data) is likely required.</p>
</div>
<div id="other-befs-and-spatio-temporal-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#other-befs-and-spatio-temporal-functions" class="anchor"></a>Other BEFs and Spatio-Temporal Functions</h3>
<p>This vignette only included FFR direct and indirect effects between other FFRs but one can imagine indirect effects between FFRS and other types of BEFs (parks, convenience stores, etc.). Furthermore, we only looked at spatial functions here, but one can imagine incorporating a temporal component too, estimating Spatial-Temporal network effects.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>In summary, this vignette described how the <code>rsstap</code> package and STAP modeling framework can be used to model BEF <em>network effects</em> composed of direct and indirect effects between BEFs, subjects and other BEFs.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
